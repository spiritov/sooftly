import"../chunks/DsnmJJEf.js";import{a5 as he,ah as ge,u as H,B as L,ao as pe,$ as o,ak as l,al as s,am as c,ai as w,C as d,an as A,a0 as r,aj as xe,af as ke,ag as me,ap as ye,x as de}from"../chunks/D74pvNIu.js";import{s as I}from"../chunks/DONB5eq7.js";import{i as T}from"../chunks/Byqm0rjg.js";import{k as ue,t as Z,s as $e,f as se}from"../chunks/D3Z1qQaB.js";import{S as le,s as D,a as e,e as oe,i as ie}from"../chunks/BEZs8I71.js";import{s as Te}from"../chunks/CIOOY7hT.js";const g=he({timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0}),x=he({timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0}),K=new le([["Checkpoint 1",58.1200213],["Checkpoint 2",70.721338219],["Course 1",119.234234934]]),E=new le([["Checkpoint 1",48.5900213],["Checkpoint 2",74.381338219],["Course 1",138.234234934]]);function Ce(i){i==="left"&&!g.timer_finish?(Object.assign(g,X),g.timer_start=!0):i==="right"&&!x.timer_finish&&(Object.assign(x,X),x.timer_start=!0)}function Oe(i){i==="left"&&!g.timer_finish?(Object.assign(g,X),g.timer_stop=!0):i==="right"&&!x.timer_finish&&(Object.assign(x,X),x.timer_stop=!0)}function je(i,n){i==="left"?(g.timer_start=!1,g.timer_finish=!0,g.finishTime=n,K.set("finish",n)):(x.timer_start=!1,x.timer_finish=!0,x.finishTime=n,E.set("finish",n))}function We(i,n,u){i==="left"?K.set(n,u):E.set(n,u)}function be(i){Object.assign(i==="left"?g:x,X)}const _e=he({state:!1}),X={timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0,checkpointTimes:new le([])};function ee(i){const n=Math.floor(i/6e3).toString().padStart(2,"0"),u=Math.floor(i/100%60).toString().padStart(2,"0"),O=Math.floor(i%100).toString().padStart(2,"0");return`${n}:${u}.${O}`}var Ne=o('<div class="absolute flex h-32 w-full items-center justify-center gap-36"><span> </span> <span> </span></div>');function Pe(i,n){ge(n,!0);let u=pe(0),O=pe(0),V=A(()=>ee(d(u))),Q=A(()=>ee(d(O)));const f=77;H(()=>{_e.state&&(L(u,0),L(O,0),_e.state=!1)}),H(()=>{if(g.timer_start){const S=Math.floor(Date.now()/10),W=setInterval(()=>{L(u,Math.floor(Date.now()/10-S),!0)},f);return()=>{clearInterval(W)}}}),H(()=>{if(x.timer_start){const S=Date.now()/10,W=setInterval(()=>{L(O,Math.floor(Date.now()/10-S),!0)},f);return()=>{clearInterval(W)}}}),H(()=>{g.timer_stop&&L(u,0)}),H(()=>{x.timer_stop&&L(O,0)});var p=Ne(),m=l(p),b=l(m,!0);s(m);var R=c(m,2),j=l(R,!0);s(R),s(p),w((S,W)=>{D(m,1,`${g.timer_start?"text-palewhite":"text-palewhite/40"} font-chivomono text-center text-5xl transition-colors duration-1000`),I(b,S),D(R,1,`${x.timer_start?"text-palewhite":"text-palewhite/40"} font-chivomono text-center text-5xl transition-colors duration-1000`),I(j,W)},[()=>g.timer_finish?ee(Math.trunc(g.finishTime*100)):d(V),()=>x.timer_finish?ee(Math.trunc(x.finishTime*100)):d(Q)]),r(i,p),xe()}var Me=o("<span></span>"),Ve=o('<span class="bg-tempus-green/60 absolute right-40 rounded-lg px-2.5 py-1 text-2xl"> </span>'),ze=o('<span class="bg-tempus-green/60 absolute left-40 rounded-lg px-2.5 py-1 text-2xl"> </span>'),De=o('<div class="relative flex items-center justify-center"><!> <span class="flex"> </span> <!></div>'),Ie=o('<div class="mt-2 flex w-full justify-center"><div class="font-chivomono flex h-86 flex-col flex-wrap items-center gap-x-60 gap-y-3 text-3xl"></div></div>');function Re(i,n){ge(n,!0);let u=A(O);{for(const[f,p]of Object.entries(e))e[f]=JSON.parse(localStorage.getItem(f));window.addEventListener("storage",f=>{e[f.key]=JSON.parse(f.newValue)})}function O(){const f=new le([]);for(const[p,m]of K.entries())f.set(p,m);for(const[p,m]of E.entries())f.has(p)?f.get(p)>E.entries()&&f.set(p,m):f.set(p,m);return f}var V=Ie(),Q=l(V);oe(Q,21,()=>d(u).entries(),ie,(f,p)=>{var m=A(()=>ye(d(p),2));let b=()=>d(m)[0],R=()=>d(m)[1];var j=De(),S=l(j);{var W=C=>{var q=Me();w(()=>D(q,1,`border-overlay-orange/70 absolute bottom-1.5 h-full w-90 rounded-lg border-t-3 hue-rotate-${e.hueRotate??""}`)),r(C,q)};T(S,C=>{b().includes("Course")&&C(W)})}var U=c(S,2),ne=l(U,!0);s(U);var te=c(U,2);{var fe=C=>{var q=ke(),ae=me(q);{var ce=t=>{var a=Ve(),v=l(a,!0);s(a),w(k=>I(v,k),[()=>(K.get(b())-E.get(b())).toFixed(1)]),r(t,a)},ve=t=>{var a=ze(),v=l(a,!0);s(a),w(k=>I(v,k),[()=>(E.get(b())-K.get(b())).toFixed(1)]),r(t,a)};T(ae,t=>{K.get(b())<E.get(b())?t(ce):t(ve,!1)})}r(C,q)};T(te,C=>{K.has(b())&&E.has(b())&&C(fe)})}s(j),w(C=>I(ne,C),[()=>ee(R()*100)]),r(f,j)}),s(Q),s(V),r(i,V),xe()}const Ge=i=>{var n=He();oe(n,20,()=>({length:2}),ie,(u,O)=>{var V=qe();r(u,V)}),s(n),Z(3,n,()=>$e),r(i,n)};var Je=o('<img class="relative z-50 flex h-24 w-fit rounded-lg" alt="flag"/>'),Fe=o("<span> </span>"),Be=o("<div></div>"),Le=o('<div class="border-palewhite/50 size-8 border-4"></div>'),Ee=o('<span class="relative bottom-0.5 text-3xl opacity-50"> </span>'),Ae=o('<div><div></div> <div id="spacer"></div> <!> <div class="flex flex-col gap-2 text-5xl"><!> <div><!> <!> <!></div></div></div>'),qe=o('<div class="flex basis-1/2 items-center justify-center border-white text-3xl first:border-r-[1px]">960x540px</div>'),He=o('<div class="bg-palewhite/50 flex h-[540px] w-full shrink-0"></div>'),Ke=o('<div class="absolute flex h-15 w-full"><span class="absolute w-full justify-center self-center text-center">vs</span> <!> <!></div>'),Qe=o('<span class="relative left-2 flex w-full skew-x-[30deg] items-center justify-center py-3"> </span>'),Ue=o('<div class="bg-fullblack/90 border-palewhite/50 relative right-8 min-w-64 skew-x-[-30deg] rounded-br-xl border-r-4 border-b-4 px-12"><!></div>'),Xe=o('<span class="relative right-2 flex w-full skew-x-[-30deg] justify-center py-3"> </span>'),Ye=o('<div class="bg-fullblack/90 border-palewhite/50 relative left-8 ml-auto min-w-64 skew-x-[30deg] rounded-bl-xl border-b-4 border-l-4 px-12"><!></div>'),Ze=o('<div class="text-palewhite/75 relative flex h-16 w-full justify-between text-3xl"><!> <!> <!></div>'),et=o('<div class="relative basis-1/2 items-center justify-center gap-4"><div></div> <span> </span></div>'),tt=o(`<span class="absolute z-999 h-screen w-full bg-black/60 p-64 text-4xl">WebSocket connecting... <span class="text-palewhite/60 text-3xl">(if this takes more than a few seconds after setting the token, it's likely failed.)</span></span>`),at=o('<span class="absolute z-999 h-screen w-full bg-black/60 p-64 text-4xl opacity-0 transition-opacity delay-1000 duration-1000 starting:opacity-100">WebSocket connected.</span>'),rt=o("<!> <!>",1),st=o('<div><div class="relative flex h-32 w-full shrink-0"><!> <!> <!></div> <!> <!> <!></div>');function dt(i,n){ge(n,!0);const u=(t,a=de)=>{var v=Ae(),k=l(v),z=c(k,4);{var G=h=>{var M=Je();w(()=>Te(M,"src",`https://countryflagsapi.netlify.app/flag/${e[a()+"Flag"]??""}.svg`)),r(h,M)};T(z,h=>{e[a()+"Flag"]&&h(G)})}var y=c(z,2),N=l(y);{var $=h=>{var M=ke(),B=me(M);ue(B,()=>e[a()+"Name"],we=>{var re=Fe(),Se=l(re,!0);s(re),w(()=>I(Se,e[a()+"Name"].name)),Z(1,re,()=>se),r(we,re)}),r(h,M)};T(N,h=>{e[a()+"Name"]&&h($)})}var _=c(N,2),J=l(_);oe(J,17,()=>({length:e[a()+"Score"]}),ie,(h,M)=>{var B=Be();w(()=>D(B,1,`starting:border-palewhite/50 starting:bg-overlay-orange/0 border-palewhite/50 bg-overlay-orange shadow-[0px_0px_9px_3px_theme(--color-overlay-orange)] size-8 border-4 transition-all duration-1000 starting:shadow-none ${e.useTeamColors?"":`hue-rotate-${e.hueRotate}`}`)),r(h,B)});var F=c(J,2);oe(F,17,()=>({length:e.maxScore-e[a()+"Score"]}),ie,(h,M)=>{var B=Le();r(h,B)});var P=c(F,2);{var Y=h=>{var M=Ee(),B=l(M);s(M),w(()=>I(B,`PR ${e[a()+"PR"]??""}`)),r(h,M)};T(P,h=>{e.usePR&&h(Y)})}s(_),s(y),s(v),w(()=>{D(v,1,`relative flex basis-1/2 items-center gap-4 ${a()==="left"?"flex-row text-left":"flex-row-reverse text-right"}`),D(k,1,`absolute -z-10 h-full w-full ${a()==="left"?`bg-linear-to-r/oklch ${e.useTeamColors?d(f):d(m)}`:`bg-linear-to-l/oklch ${e.useTeamColors?d(p):d(b)}`}`),D(_,1,`flex gap-2 ${a()==="left"?"flex-row":"flex-row-reverse"}`)}),r(t,v)},O=t=>{var a=Ze(),v=l(a);{var k=$=>{var _=Ke(),J=c(l(_),2);V(J,()=>"left");var F=c(J,2);V(F,()=>"right"),s(_),r($,_)};T(v,$=>{e.useTeams&&!e.useSinglePOV&&$(k)})}var z=c(v,2);{var G=$=>{var _=Ue(),J=l(_);ue(J,()=>e.stage,F=>{var P=Qe(),Y=l(P,!0);s(P),w(()=>I(Y,e.stage)),Z(1,P,()=>se),r(F,P)}),s(_),r($,_)};T(z,$=>{e.stage&&$(G)})}var y=c(z,2);{var N=$=>{var _=Ye(),J=l(_);ue(J,()=>e.map,F=>{var P=Xe(),Y=l(P,!0);s(P),w(()=>I(Y,e.map)),Z(1,P,()=>se),r(F,P)}),s(_),r($,_)};T(y,$=>{e.map&&$(N)})}s(a),r(t,a)},V=(t,a=de,v=de)=>{var k=et(),z=l(k),G=c(z,2),y=l(G,!0);s(G),s(k),w(N=>{D(z,1,`absolute -z-10 h-full w-full ${N??""}`),D(G,1,`text-palewhite absolute z-10 flex h-full w-full items-center justify-center text-4xl text-nowrap ${a()==="left"?"flex-row-reverse":"flex-row"}`),I(y,e[a()+"Team"])},[()=>a()==="left"?` bg-linear-to-r/oklch ${(e.useTeamColors?d(f):d(m)).replace("to-fullblack/60","to-fullblack/0")} to-90%`:` bg-linear-to-l/oklch ${(e.useTeamColors?d(p):d(b)).replace("to-fullblack/60","to-fullblack/0")} to-90%`]),r(t,k)};function Q(t){if(t.track!==0)return;const a=`${t.steamid}`===e.leftName.steamid?"left":`${t.steamid}`===e.rightName.steamid?"right":null;if(a)switch(t.type){case"timer_start":Ce(a);break;case"timer_stop":Oe(a);break;case"timer_checkpoint":console.log("sending checkpoint to side "+a),We(a,t.formattedCheckpoint,t.time);break;case"timer_finish":je(a,t.time);break}}let f=A(()=>`from-tf-blu ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75%`),p=A(()=>`from-tf-red ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75%`),m=A(()=>`from-overlay-orange/90 ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),b=A(()=>`from-overlay-orange/90 ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),R=pe(!1),j;{for(const[t,a]of Object.entries(e))e[t]=JSON.parse(localStorage.getItem(t));window.addEventListener("storage",t=>{e[t.key]=JSON.parse(t.newValue)}),H(()=>{if(e.useWebSocket&&e.useWebSocketToken!==""){const t=e.useWebSocketToken;j=new WebSocket(`wss://flyio-silent-sea-6505.fly.dev/?token=${t}`),j.onopen=a=>{console.log("[WebSocket] connection opened."),L(R,!0)},j.onmessage=a=>{const v=JSON.parse(a.data);console.log("[WebSocket] received data..",v),Q(v)}}return()=>{j&&(j.close(),console.log("[WebSocket] closed previous connection."),L(R,!1))}}),e.useWebSocket&&e.useWebSocketToken!==""&&H(()=>{e.leftName,e.rightName,be("left"),be("right"),_e.state=!0})}var S=st(),W=l(S),U=l(W);{var ne=t=>{var a=rt(),v=me(a);Pe(v,{});var k=c(v,2);{var z=y=>{var N=tt();Z(1,N,()=>se),r(y,N)},G=y=>{var N=at();r(y,N)};T(k,y=>{d(R)?y(G,!1):y(z)})}r(t,a)};T(U,t=>{e.useWebSocket&&e.useWebSocketToken!==""&&e.leftName.steamid&&e.rightName.steamid&&t(ne)})}var te=c(U,2);u(te,()=>"left");var fe=c(te,2);u(fe,()=>"right"),s(W);var C=c(W,2);{var q=t=>{Ge(t)};T(C,t=>{e.useSinglePOV||t(q)})}var ae=c(C,2);O(ae);var ce=c(ae,2);{var ve=t=>{Re(t,{})};T(ce,t=>{e.useWebSocket&&e.useWebSocketToken!==""&&e.leftName.steamid&&e.rightName.steamid&&t(ve)})}s(S),w(t=>D(S,1,`font-${t??""} flex h-screen w-screen flex-col overflow-hidden`),[()=>e.font.toLowerCase()]),r(i,S),xe()}export{dt as component};
