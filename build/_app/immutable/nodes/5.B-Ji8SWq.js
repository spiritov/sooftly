import"../chunks/DsnmJJEf.js";import{a5 as _e,ah as he,u as U,B as q,ao as ue,$ as i,ak as n,al as o,am as d,ai as _,C as c,an as F,a0 as r,aj as ge,af as ke,ag as pe,ap as Se,x as ce}from"../chunks/D74pvNIu.js";import{s as V}from"../chunks/DONB5eq7.js";import{i as W}from"../chunks/Byqm0rjg.js";import{t as K,f as X,s as we,k as de}from"../chunks/D3Z1qQaB.js";import{S as xe,s as $,a as e,e as ie,i as le}from"../chunks/DGwUJ0I5.js";import{s as Te}from"../chunks/CIOOY7hT.js";const b=_e({timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0}),k=_e({timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0}),D=new xe([]),H=new xe([]);function Oe(l){l==="left"&&!b.timer_finish?(Object.assign(b,Y),b.timer_start=!0):l==="right"&&!k.timer_finish&&(Object.assign(k,Y),k.timer_start=!0)}function je(l){l==="left"&&!b.timer_finish?(Object.assign(b,Y),D.clear(),b.timer_stop=!0):l==="right"&&!k.timer_finish&&(Object.assign(k,Y),D.clear(),k.timer_stop=!0)}function We(l,f){l==="left"?(b.timer_start=!1,b.timer_finish=!0,b.finishTime=f,D.set("finish",f)):(k.timer_start=!1,k.timer_finish=!0,k.finishTime=f,H.set("finish",f))}function Ce(l,f,u){l==="left"?D.set(f,u):H.set(f,u)}function be(l){l==="left"?(Object.assign(b,Y),D.clear()):(Object.assign(k,Y),H.clear())}const me=_e({state:!1}),Y={timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0};function te(l){const f=Math.floor(l/6e3).toString().padStart(2,"0"),u=Math.floor(l/100%60).toString().padStart(2,"0"),S=Math.floor(l%100).toString().padStart(2,"0");return`${f}:${u}.${S}`}var Ne=i('<div class="absolute flex h-32 w-full items-center justify-center gap-36"><span> </span> <span> </span></div>');function Pe(l,f){he(f,!0);let u=ue(0),S=ue(0),B=F(()=>te(c(u))),Q=F(()=>te(c(S)));const I=77;U(()=>{me.state&&(q(u,0),q(S,0),be("left"),be("right"),me.state=!1)}),U(()=>{if(b.timer_start){const h=Math.floor(Date.now()/10),C=setInterval(()=>{q(u,Math.floor(Date.now()/10-h),!0)},I);return()=>{clearInterval(C)}}}),U(()=>{if(k.timer_start){const h=Date.now()/10,C=setInterval(()=>{q(S,Math.floor(Date.now()/10-h),!0)},I);return()=>{clearInterval(C)}}}),U(()=>{b.timer_stop&&q(u,0)}),U(()=>{k.timer_stop&&q(S,0)});var v=Ne(),p=n(v),T=n(p,!0);o(p);var m=d(p,2),R=n(m,!0);o(m),o(v),_((h,C)=>{$(p,1,`${b.timer_start?"text-palewhite":"text-palewhite/40"} font-chivomono text-center text-5xl transition-colors duration-1000`),V(T,h),$(m,1,`${k.timer_start?"text-palewhite":"text-palewhite/40"} font-chivomono text-center text-5xl transition-colors duration-1000`),V(R,C)},[()=>b.timer_finish?te(Math.trunc(b.finishTime*100)):c(B),()=>k.timer_finish?te(Math.trunc(k.finishTime*100)):c(Q)]),r(l,v),ge()}var ze=i("<span></span>"),Me=i("<span> </span>"),Ve=i("<span> </span>"),De=i('<div class="relative flex items-center justify-center"><!> <span class="flex"> </span> <!></div>'),Ie=i('<div class="mt-2 flex w-full justify-center"><div></div></div>');function Re(l,f){he(f,!0);let u=F(B),S=F(()=>c(u).size);{for(const[v,p]of Object.entries(e))e[v]=JSON.parse(localStorage.getItem(v));window.addEventListener("storage",v=>{e[v.key]=JSON.parse(v.newValue)})}function B(){const v=new xe([]);for(const[p,T]of D.entries())v.set(p,T);for(const[p,T]of H.entries())v.has(p)?v.get(p)>T&&v.set(p,T):v.set(p,T);return v}var Q=Ie(),I=n(Q);ie(I,21,()=>c(u).entries(),le,(v,p)=>{var T=F(()=>Se(c(p),2));let m=()=>c(T)[0],R=()=>c(T)[1];var h=De(),C=n(h);{var ae=N=>{var L=ze();_(()=>$(L,1,`border-overlay-orange/70 absolute bottom-1.5 h-full w-90 rounded-lg border-t-3 hue-rotate-${e.hueRotate??""}`)),r(N,L)};W(C,N=>{m().includes("Course")&&N(ae)})}var Z=d(C,2),re=n(Z,!0);o(Z);var ne=d(Z,2);{var se=N=>{var L=ke(),fe=pe(L);{var ve=t=>{var s=Me(),w=n(s,!0);o(s),_(y=>{$(s,1,`bg-tempus-green/60 absolute rounded-lg px-2.5 ${c(S)>14?"right-32 py-0.5 text-xl":"right-40 py-1 text-2xl"}`),V(w,y)},[()=>(D.get(m())-H.get(m())).toFixed(1)]),K(7,s,()=>X),r(t,s)},a=t=>{var s=Ve(),w=n(s,!0);o(s),_(y=>{$(s,1,`bg-tempus-green/60 absolute rounded-lg px-2.5 ${c(S)>14?"left-32 py-0.5 text-xl":"left-40 py-1 text-2xl"}`),V(w,y)},[()=>(H.get(m())-D.get(m())).toFixed(1)]),K(7,s,()=>X),r(t,s)};W(fe,t=>{D.get(m())<H.get(m())?t(ve):t(a,!1)})}r(N,L)};W(ne,N=>{D.has(m())&&H.has(m())&&N(se)})}o(h),_(N=>V(re,N),[()=>te(R()*100)]),K(1,h,()=>we),r(v,h)}),o(I),o(Q),_(()=>$(I,1,`font-chivomono flex h-83 flex-col flex-wrap items-center gap-x-60 ${c(S)>14?"gap-y-1 text-2xl":"gap-y-3 text-3xl"}`)),r(l,Q),ge()}const Ge=l=>{var f=He();ie(f,20,()=>({length:2}),le,(u,S)=>{var B=qe();r(u,B)}),o(f),_(()=>$(f,1,`bg-palewhite/50 flex h-[540px] w-full shrink-0 transition-opacity duration-500 ${e.usePOVDimensions?"":"opacity-0"}`)),K(3,f,()=>we),r(l,f)};var Je=i('<img class="relative z-50 flex h-24 w-fit rounded-lg" alt=""/>'),Fe=i("<span> </span>"),Be=i("<div></div>"),Le=i('<div class="border-palewhite/50 size-8 border-4"></div>'),Ee=i('<span class="relative bottom-0.5 text-3xl opacity-50"> </span>'),Ae=i('<div><div></div> <div id="spacer"></div> <!> <div class="flex flex-col gap-2 text-5xl"><!> <div><!> <!> <!></div></div></div>'),qe=i('<div class="flex basis-1/2 items-center justify-center border-white text-3xl first:border-r-[1px]">960x540px</div>'),He=i("<div></div>"),Ke=i('<div class="absolute flex h-15 w-full"><span class="absolute w-full justify-center self-center text-center">vs</span> <!> <!></div>'),Qe=i('<span class="relative left-2 flex w-full skew-x-[30deg] items-center justify-center py-3"> </span>'),Ue=i('<div class="bg-fullblack/90 border-palewhite/50 relative right-8 min-w-64 skew-x-[-30deg] rounded-br-xl border-r-4 border-b-4 px-12"><!></div>'),Xe=i('<span class="relative right-2 flex w-full skew-x-[-30deg] justify-center py-3"> </span>'),Ye=i('<div class="bg-fullblack/90 border-palewhite/50 relative left-8 ml-auto min-w-64 skew-x-[30deg] rounded-bl-xl border-b-4 border-l-4 px-12"><!></div>'),Ze=i('<div class="text-palewhite/75 relative flex h-16 w-full justify-between text-3xl"><!> <!> <!></div>'),et=i('<div class="relative basis-1/2 items-center justify-center gap-4"><div></div> <span> </span></div>'),tt=i(`<span class="absolute z-999 h-screen w-full bg-black/60 p-64 text-4xl">WebSocket connecting... <span class="text-palewhite/60 text-3xl">(if this takes more than a few seconds after setting the token, it's likely failed.)</span></span>`),at=i('<span class="absolute z-999 h-screen w-full bg-black/60 p-64 text-4xl opacity-0 transition-opacity delay-1000 duration-1000 starting:opacity-100">WebSocket connected.</span>'),rt=i("<!> <!>",1),st=i('<div><div class="relative flex h-32 w-full shrink-0"><!> <!> <!></div> <!> <!> <!></div>');function dt(l,f){he(f,!0);const u=(a,t=ce)=>{var s=Ae(),w=n(s),y=d(w,4);{var G=x=>{var M=Je();_(()=>Te(M,"src",`https://countryflagsapi.netlify.app/flag/${e[t()+"Flag"]??""}.svg`)),r(x,M)};W(y,x=>{e[t()+"Flag"]&&x(G)})}var O=d(y,2),P=n(O);{var j=x=>{var M=ke(),A=pe(M);de(A,()=>e[t()+"Name"],ye=>{var oe=Fe(),$e=n(oe,!0);o(oe),_(()=>V($e,e[t()+"Name"].name)),K(1,oe,()=>X),r(ye,oe)}),r(x,M)};W(P,x=>{e[t()+"Name"]&&x(j)})}var g=d(P,2),J=n(g);ie(J,17,()=>({length:e[t()+"Score"]}),le,(x,M)=>{var A=Be();_(()=>$(A,1,`starting:border-palewhite/50 starting:bg-overlay-orange/0 border-palewhite/50 bg-overlay-orange shadow-[0px_0px_9px_3px_theme(--color-overlay-orange)] size-8 border-4 transition-all duration-1000 starting:shadow-none ${e.useTeamColors?"":`hue-rotate-${e.hueRotate}`}`)),r(x,A)});var E=d(J,2);ie(E,17,()=>({length:e.maxScore-e[t()+"Score"]}),le,(x,M)=>{var A=Le();r(x,A)});var z=d(E,2);{var ee=x=>{var M=Ee(),A=n(M);o(M),_(()=>V(A,`PR ${e[t()+"PR"]??""}`)),r(x,M)};W(z,x=>{e.usePR&&x(ee)})}o(g),o(O),o(s),_(()=>{$(s,1,`relative flex basis-1/2 items-center gap-4 ${t()==="left"?"flex-row text-left":"flex-row-reverse text-right"}`),$(w,1,`absolute -z-10 h-full w-full ${t()==="left"?`bg-linear-to-r/oklch ${e.useTeamColors?c(I):c(p)}`:`bg-linear-to-l/oklch ${e.useTeamColors?c(v):c(T)}`}`),$(g,1,`flex gap-2 ${t()==="left"?"flex-row":"flex-row-reverse"}`)}),r(a,s)},S=a=>{var t=Ze(),s=n(t);{var w=j=>{var g=Ke(),J=d(n(g),2);B(J,()=>"left");var E=d(J,2);B(E,()=>"right"),o(g),r(j,g)};W(s,j=>{e.useTeams&&!e.useSinglePOV&&j(w)})}var y=d(s,2);{var G=j=>{var g=Ue(),J=n(g);de(J,()=>e.stage,E=>{var z=Qe(),ee=n(z,!0);o(z),_(()=>V(ee,e.stage)),K(1,z,()=>X),r(E,z)}),o(g),r(j,g)};W(y,j=>{e.stage&&j(G)})}var O=d(y,2);{var P=j=>{var g=Ye(),J=n(g);de(J,()=>e.map,E=>{var z=Xe(),ee=n(z,!0);o(z),_(()=>V(ee,e.map)),K(1,z,()=>X),r(E,z)}),o(g),r(j,g)};W(O,j=>{e.map&&j(P)})}o(t),r(a,t)},B=(a,t=ce,s=ce)=>{var w=et(),y=n(w),G=d(y,2),O=n(G,!0);o(G),o(w),_(P=>{$(y,1,`absolute -z-10 h-full w-full ${P??""}`),$(G,1,`text-palewhite absolute z-10 flex h-full w-full items-center justify-center text-4xl text-nowrap ${t()==="left"?"flex-row-reverse":"flex-row"}`),V(O,e[t()+"Team"])},[()=>t()==="left"?` bg-linear-to-r/oklch ${(e.useTeamColors?c(I):c(p)).replace("to-fullblack/60","to-fullblack/0")} to-90%`:` bg-linear-to-l/oklch ${(e.useTeamColors?c(v):c(T)).replace("to-fullblack/60","to-fullblack/0")} to-90%`]),r(a,w)};function Q(a){if(a.track!==0)return;const t=`${a.steamid}`===e.leftName.steamid?"left":`${a.steamid}`===e.rightName.steamid?"right":null;if(t)switch(a.type){case"timer_start":Oe(t);break;case"timer_stop":je(t);break;case"timer_checkpoint":console.log("sending checkpoint to side "+t),Ce(t,a.formattedCheckpoint,a.time);break;case"timer_finish":We(t,a.time);break}}let I=F(()=>`from-tf-blu ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75%`),v=F(()=>`from-tf-red ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75%`),p=F(()=>`from-overlay-orange/90 ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),T=F(()=>`from-overlay-orange/90 ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),m=ue(!1),R;{for(const[a,t]of Object.entries(e))e[a]=JSON.parse(localStorage.getItem(a));window.addEventListener("storage",a=>{e[a.key]=JSON.parse(a.newValue)}),U(()=>{if(e.useWebSocket&&e.useWebSocketToken!==""){const a=e.useWebSocketToken;R=new WebSocket(`wss://flyio-silent-sea-6505.fly.dev/?token=${a}`),R.onopen=t=>{console.log("[WebSocket] connection opened."),q(m,!0)},R.onmessage=t=>{const s=JSON.parse(t.data);console.log("[WebSocket] received data..",s),Q(s)}}return()=>{R&&(R.close(),console.log("[WebSocket] closed previous connection."),q(m,!1))}}),e.useWebSocket&&e.useWebSocketToken!==""&&U(()=>{e.leftName,e.rightName,me.state=!0,e.resetPulse=!0})}var h=st(),C=n(h),ae=n(C);{var Z=a=>{var t=rt(),s=pe(t);Pe(s,{});var w=d(s,2);{var y=O=>{var P=tt();K(1,P,()=>X),r(O,P)},G=O=>{var P=at();r(O,P)};W(w,O=>{c(m)?O(G,!1):O(y)})}r(a,t)};W(ae,a=>{e.useWebSocket&&e.useWebSocketToken!==""&&e.leftName.steamid&&e.rightName.steamid&&a(Z)})}var re=d(ae,2);u(re,()=>"left");var ne=d(re,2);u(ne,()=>"right"),o(C);var se=d(C,2);{var N=a=>{Ge(a)};W(se,a=>{e.useSinglePOV||a(N)})}var L=d(se,2);S(L);var fe=d(L,2);{var ve=a=>{Re(a,{})};W(fe,a=>{e.useWebSocket&&e.useWebSocketToken!==""&&e.leftName.steamid&&e.rightName.steamid&&a(ve)})}o(h),_(a=>$(h,1,`font-${a??""} flex h-screen w-screen flex-col overflow-hidden`),[()=>e.font.toLowerCase()]),r(l,h),ge()}export{dt as component};
