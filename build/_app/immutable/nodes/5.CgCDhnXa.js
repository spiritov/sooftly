import"../chunks/DsnmJJEf.js";import{a5 as _e,ah as he,u as Q,B as E,ao as ue,$ as o,ak as l,al as s,am as c,ai as w,C as d,an as q,a0 as r,aj as ge,af as ke,ag as pe,ap as $e,x as ve}from"../chunks/D74pvNIu.js";import{s as I}from"../chunks/DONB5eq7.js";import{i as T}from"../chunks/Byqm0rjg.js";import{t as H,f as Y,s as we,k as de}from"../chunks/D3Z1qQaB.js";import{S as xe,s as D,a as e,e as oe,i as ie}from"../chunks/BEZs8I71.js";import{s as Te}from"../chunks/CIOOY7hT.js";const g=_e({timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0}),x=_e({timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0}),R=new xe([]),A=new xe([]);function Oe(i){i==="left"&&!g.timer_finish?(Object.assign(g,Z),g.timer_start=!0):i==="right"&&!x.timer_finish&&(Object.assign(x,Z),x.timer_start=!0)}function je(i){i==="left"&&!g.timer_finish?(Object.assign(g,Z),R.clear(),g.timer_stop=!0):i==="right"&&!x.timer_finish&&(Object.assign(x,Z),R.clear(),x.timer_stop=!0)}function We(i,n){i==="left"?(g.timer_start=!1,g.timer_finish=!0,g.finishTime=n,R.set("finish",n)):(x.timer_start=!1,x.timer_finish=!0,x.finishTime=n,A.set("finish",n))}function Ce(i,n,u){i==="left"?R.set(n,u):A.set(n,u)}function be(i){i==="left"?(Object.assign(g,Z),R.clear()):(Object.assign(x,Z),A.clear())}const me=_e({state:!1}),Z={timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0};function te(i){const n=Math.floor(i/6e3).toString().padStart(2,"0"),u=Math.floor(i/100%60).toString().padStart(2,"0"),W=Math.floor(i%100).toString().padStart(2,"0");return`${n}:${u}.${W}`}var Ne=o('<div class="absolute flex h-32 w-full items-center justify-center gap-36"><span> </span> <span> </span></div>');function Pe(i,n){he(n,!0);let u=ue(0),W=ue(0),V=q(()=>te(d(u))),U=q(()=>te(d(W)));const f=77;Q(()=>{me.state&&(E(u,0),E(W,0),me.state=!1)}),Q(()=>{if(g.timer_start){const S=Math.floor(Date.now()/10),C=setInterval(()=>{E(u,Math.floor(Date.now()/10-S),!0)},f);return()=>{clearInterval(C)}}}),Q(()=>{if(x.timer_start){const S=Date.now()/10,C=setInterval(()=>{E(W,Math.floor(Date.now()/10-S),!0)},f);return()=>{clearInterval(C)}}}),Q(()=>{g.timer_stop&&E(u,0)}),Q(()=>{x.timer_stop&&E(W,0)});var p=Ne(),m=l(p),b=l(m,!0);s(m);var G=c(m,2),O=l(G,!0);s(G),s(p),w((S,C)=>{D(m,1,`${g.timer_start?"text-palewhite":"text-palewhite/40"} font-chivomono text-center text-5xl transition-colors duration-1000`),I(b,S),D(G,1,`${x.timer_start?"text-palewhite":"text-palewhite/40"} font-chivomono text-center text-5xl transition-colors duration-1000`),I(O,C)},[()=>g.timer_finish?te(Math.trunc(g.finishTime*100)):d(V),()=>x.timer_finish?te(Math.trunc(x.finishTime*100)):d(U)]),r(i,p),ge()}var Me=o("<span></span>"),Ve=o('<span class="bg-tempus-green/60 absolute right-40 rounded-lg px-2.5 py-1 text-2xl"> </span>'),ze=o('<span class="bg-tempus-green/60 absolute left-40 rounded-lg px-2.5 py-1 text-2xl"> </span>'),De=o('<div class="relative flex items-center justify-center"><!> <span class="flex"> </span> <!></div>'),Ie=o('<div class="mt-2 flex w-full justify-center"><div class="font-chivomono flex h-86 flex-col flex-wrap items-center gap-x-60 gap-y-3 text-3xl"></div></div>');function Re(i,n){he(n,!0);let u=q(W);{for(const[f,p]of Object.entries(e))e[f]=JSON.parse(localStorage.getItem(f));window.addEventListener("storage",f=>{e[f.key]=JSON.parse(f.newValue)})}function W(){const f=new xe([]);for(const[p,m]of R.entries())f.set(p,m);for(const[p,m]of A.entries())f.has(p)?f.get(p)>m&&f.set(p,m):f.set(p,m);return f}var V=Ie(),U=l(V);oe(U,21,()=>d(u).entries(),ie,(f,p)=>{var m=q(()=>$e(d(p),2));let b=()=>d(m)[0],G=()=>d(m)[1];var O=De(),S=l(O);{var C=j=>{var K=Me();w(()=>D(K,1,`border-overlay-orange/70 absolute bottom-1.5 h-full w-90 rounded-lg border-t-3 hue-rotate-${e.hueRotate??""}`)),r(j,K)};T(S,j=>{b().includes("Course")&&j(C)})}var X=c(S,2),le=l(X,!0);s(X);var ae=c(X,2);{var ne=j=>{var K=ke(),re=pe(K);{var fe=a=>{var t=Ve(),v=l(t,!0);s(t),w(k=>I(v,k),[()=>(R.get(b())-A.get(b())).toFixed(1)]),H(3,t,()=>Y),r(a,t)},ce=a=>{var t=ze(),v=l(t,!0);s(t),w(k=>I(v,k),[()=>(A.get(b())-R.get(b())).toFixed(1)]),H(7,t,()=>Y),r(a,t)};T(re,a=>{R.get(b())<A.get(b())?a(fe):a(ce,!1)})}r(j,K)};T(ae,j=>{R.has(b())&&A.has(b())&&j(ne)})}s(O),w(j=>I(le,j),[()=>te(G()*100)]),H(1,O,()=>we),r(f,O)}),s(U),s(V),r(i,V),ge()}const Ge=i=>{var n=He();oe(n,20,()=>({length:2}),ie,(u,W)=>{var V=qe();r(u,V)}),s(n),H(3,n,()=>we),r(i,n)};var Je=o('<img class="relative z-50 flex h-24 w-fit rounded-lg" alt="flag"/>'),Fe=o("<span> </span>"),Be=o("<div></div>"),Le=o('<div class="border-palewhite/50 size-8 border-4"></div>'),Ee=o('<span class="relative bottom-0.5 text-3xl opacity-50"> </span>'),Ae=o('<div><div></div> <div id="spacer"></div> <!> <div class="flex flex-col gap-2 text-5xl"><!> <div><!> <!> <!></div></div></div>'),qe=o('<div class="flex basis-1/2 items-center justify-center border-white text-3xl first:border-r-[1px]">960x540px</div>'),He=o('<div class="bg-palewhite/50 flex h-[540px] w-full shrink-0"></div>'),Ke=o('<div class="absolute flex h-15 w-full"><span class="absolute w-full justify-center self-center text-center">vs</span> <!> <!></div>'),Qe=o('<span class="relative left-2 flex w-full skew-x-[30deg] items-center justify-center py-3"> </span>'),Ue=o('<div class="bg-fullblack/90 border-palewhite/50 relative right-8 min-w-64 skew-x-[-30deg] rounded-br-xl border-r-4 border-b-4 px-12"><!></div>'),Xe=o('<span class="relative right-2 flex w-full skew-x-[-30deg] justify-center py-3"> </span>'),Ye=o('<div class="bg-fullblack/90 border-palewhite/50 relative left-8 ml-auto min-w-64 skew-x-[30deg] rounded-bl-xl border-b-4 border-l-4 px-12"><!></div>'),Ze=o('<div class="text-palewhite/75 relative flex h-16 w-full justify-between text-3xl"><!> <!> <!></div>'),et=o('<div class="relative basis-1/2 items-center justify-center gap-4"><div></div> <span> </span></div>'),tt=o(`<span class="absolute z-999 h-screen w-full bg-black/60 p-64 text-4xl">WebSocket connecting... <span class="text-palewhite/60 text-3xl">(if this takes more than a few seconds after setting the token, it's likely failed.)</span></span>`),at=o('<span class="absolute z-999 h-screen w-full bg-black/60 p-64 text-4xl opacity-0 transition-opacity delay-1000 duration-1000 starting:opacity-100">WebSocket connected.</span>'),rt=o("<!> <!>",1),st=o('<div><div class="relative flex h-32 w-full shrink-0"><!> <!> <!></div> <!> <!> <!></div>');function dt(i,n){he(n,!0);const u=(a,t=ve)=>{var v=Ae(),k=l(v),z=c(k,4);{var J=h=>{var M=Je();w(()=>Te(M,"src",`https://countryflagsapi.netlify.app/flag/${e[t()+"Flag"]??""}.svg`)),r(h,M)};T(z,h=>{e[t()+"Flag"]&&h(J)})}var y=c(z,2),N=l(y);{var $=h=>{var M=ke(),L=pe(M);de(L,()=>e[t()+"Name"],Se=>{var se=Fe(),ye=l(se,!0);s(se),w(()=>I(ye,e[t()+"Name"].name)),H(1,se,()=>Y),r(Se,se)}),r(h,M)};T(N,h=>{e[t()+"Name"]&&h($)})}var _=c(N,2),F=l(_);oe(F,17,()=>({length:e[t()+"Score"]}),ie,(h,M)=>{var L=Be();w(()=>D(L,1,`starting:border-palewhite/50 starting:bg-overlay-orange/0 border-palewhite/50 bg-overlay-orange shadow-[0px_0px_9px_3px_theme(--color-overlay-orange)] size-8 border-4 transition-all duration-1000 starting:shadow-none ${e.useTeamColors?"":`hue-rotate-${e.hueRotate}`}`)),r(h,L)});var B=c(F,2);oe(B,17,()=>({length:e.maxScore-e[t()+"Score"]}),ie,(h,M)=>{var L=Le();r(h,L)});var P=c(B,2);{var ee=h=>{var M=Ee(),L=l(M);s(M),w(()=>I(L,`PR ${e[t()+"PR"]??""}`)),r(h,M)};T(P,h=>{e.usePR&&h(ee)})}s(_),s(y),s(v),w(()=>{D(v,1,`relative flex basis-1/2 items-center gap-4 ${t()==="left"?"flex-row text-left":"flex-row-reverse text-right"}`),D(k,1,`absolute -z-10 h-full w-full ${t()==="left"?`bg-linear-to-r/oklch ${e.useTeamColors?d(f):d(m)}`:`bg-linear-to-l/oklch ${e.useTeamColors?d(p):d(b)}`}`),D(_,1,`flex gap-2 ${t()==="left"?"flex-row":"flex-row-reverse"}`)}),r(a,v)},W=a=>{var t=Ze(),v=l(t);{var k=$=>{var _=Ke(),F=c(l(_),2);V(F,()=>"left");var B=c(F,2);V(B,()=>"right"),s(_),r($,_)};T(v,$=>{e.useTeams&&!e.useSinglePOV&&$(k)})}var z=c(v,2);{var J=$=>{var _=Ue(),F=l(_);de(F,()=>e.stage,B=>{var P=Qe(),ee=l(P,!0);s(P),w(()=>I(ee,e.stage)),H(1,P,()=>Y),r(B,P)}),s(_),r($,_)};T(z,$=>{e.stage&&$(J)})}var y=c(z,2);{var N=$=>{var _=Ye(),F=l(_);de(F,()=>e.map,B=>{var P=Xe(),ee=l(P,!0);s(P),w(()=>I(ee,e.map)),H(1,P,()=>Y),r(B,P)}),s(_),r($,_)};T(y,$=>{e.map&&$(N)})}s(t),r(a,t)},V=(a,t=ve,v=ve)=>{var k=et(),z=l(k),J=c(z,2),y=l(J,!0);s(J),s(k),w(N=>{D(z,1,`absolute -z-10 h-full w-full ${N??""}`),D(J,1,`text-palewhite absolute z-10 flex h-full w-full items-center justify-center text-4xl text-nowrap ${t()==="left"?"flex-row-reverse":"flex-row"}`),I(y,e[t()+"Team"])},[()=>t()==="left"?` bg-linear-to-r/oklch ${(e.useTeamColors?d(f):d(m)).replace("to-fullblack/60","to-fullblack/0")} to-90%`:` bg-linear-to-l/oklch ${(e.useTeamColors?d(p):d(b)).replace("to-fullblack/60","to-fullblack/0")} to-90%`]),r(a,k)};function U(a){if(a.track!==0)return;const t=`${a.steamid}`===e.leftName.steamid?"left":`${a.steamid}`===e.rightName.steamid?"right":null;if(t)switch(a.type){case"timer_start":Oe(t);break;case"timer_stop":je(t);break;case"timer_checkpoint":console.log("sending checkpoint to side "+t),Ce(t,a.formattedCheckpoint,a.time);break;case"timer_finish":We(t,a.time);break}}let f=q(()=>`from-tf-blu ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75%`),p=q(()=>`from-tf-red ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75%`),m=q(()=>`from-overlay-orange/90 ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),b=q(()=>`from-overlay-orange/90 ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),G=ue(!1),O;{for(const[a,t]of Object.entries(e))e[a]=JSON.parse(localStorage.getItem(a));window.addEventListener("storage",a=>{e[a.key]=JSON.parse(a.newValue)}),Q(()=>{if(e.useWebSocket&&e.useWebSocketToken!==""){const a=e.useWebSocketToken;O=new WebSocket(`wss://flyio-silent-sea-6505.fly.dev/?token=${a}`),O.onopen=t=>{console.log("[WebSocket] connection opened."),E(G,!0)},O.onmessage=t=>{const v=JSON.parse(t.data);console.log("[WebSocket] received data..",v),U(v)}}return()=>{O&&(O.close(),console.log("[WebSocket] closed previous connection."),E(G,!1))}}),e.useWebSocket&&e.useWebSocketToken!==""&&Q(()=>{e.leftName,e.rightName,be("left"),be("right"),me.state=!0})}var S=st(),C=l(S),X=l(C);{var le=a=>{var t=rt(),v=pe(t);Pe(v,{});var k=c(v,2);{var z=y=>{var N=tt();H(1,N,()=>Y),r(y,N)},J=y=>{var N=at();r(y,N)};T(k,y=>{d(G)?y(J,!1):y(z)})}r(a,t)};T(X,a=>{e.useWebSocket&&e.useWebSocketToken!==""&&e.leftName.steamid&&e.rightName.steamid&&a(le)})}var ae=c(X,2);u(ae,()=>"left");var ne=c(ae,2);u(ne,()=>"right"),s(C);var j=c(C,2);{var K=a=>{Ge(a)};T(j,a=>{e.useSinglePOV||a(K)})}var re=c(j,2);W(re);var fe=c(re,2);{var ce=a=>{Re(a,{})};T(fe,a=>{e.useWebSocket&&e.useWebSocketToken!==""&&e.leftName.steamid&&e.rightName.steamid&&a(ce)})}s(S),w(a=>D(S,1,`font-${a??""} flex h-screen w-screen flex-col overflow-hidden`),[()=>e.font.toLowerCase()]),r(i,S),ge()}export{dt as component};
