import"../chunks/DsnmJJEf.js";import{a5 as he,ah as ge,u as K,B as L,ao as pe,$ as o,ak as l,al as s,am as v,ai as w,C as d,an as A,a0 as r,aj as xe,af as ke,ag as me,ap as $e,x as de}from"../chunks/D74pvNIu.js";import{s as I}from"../chunks/DONB5eq7.js";import{i as T}from"../chunks/Byqm0rjg.js";import{t as q,f as Y,s as we,k as ue}from"../chunks/D3Z1qQaB.js";import{S as le,s as D,a as e,e as oe,i as ie}from"../chunks/BEZs8I71.js";import{s as Te}from"../chunks/CIOOY7hT.js";const g=he({timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0}),x=he({timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0}),Q=new le([]),E=new le([]);function Oe(i){i==="left"&&!g.timer_finish?(Object.assign(g,Z),g.timer_start=!0):i==="right"&&!x.timer_finish&&(Object.assign(x,Z),x.timer_start=!0)}function je(i){i==="left"&&!g.timer_finish?(Object.assign(g,Z),g.timer_stop=!0):i==="right"&&!x.timer_finish&&(Object.assign(x,Z),x.timer_stop=!0)}function We(i,n){i==="left"?(g.timer_start=!1,g.timer_finish=!0,g.finishTime=n,Q.set("finish",n)):(x.timer_start=!1,x.timer_finish=!0,x.finishTime=n,E.set("finish",n))}function Ce(i,n,u){i==="left"?Q.set(n,u):E.set(n,u)}function be(i){Object.assign(i==="left"?g:x,Z)}const _e=he({state:!1}),Z={timer_start:!1,timer_stop:!1,timer_finish:!1,finishTime:0,checkpointTimes:new le([])};function te(i){const n=Math.floor(i/6e3).toString().padStart(2,"0"),u=Math.floor(i/100%60).toString().padStart(2,"0"),W=Math.floor(i%100).toString().padStart(2,"0");return`${n}:${u}.${W}`}var Ne=o('<div class="absolute flex h-32 w-full items-center justify-center gap-36"><span> </span> <span> </span></div>');function Pe(i,n){ge(n,!0);let u=pe(0),W=pe(0),V=A(()=>te(d(u))),U=A(()=>te(d(W)));const f=77;K(()=>{_e.state&&(L(u,0),L(W,0),_e.state=!1)}),K(()=>{if(g.timer_start){const S=Math.floor(Date.now()/10),C=setInterval(()=>{L(u,Math.floor(Date.now()/10-S),!0)},f);return()=>{clearInterval(C)}}}),K(()=>{if(x.timer_start){const S=Date.now()/10,C=setInterval(()=>{L(W,Math.floor(Date.now()/10-S),!0)},f);return()=>{clearInterval(C)}}}),K(()=>{g.timer_stop&&L(u,0)}),K(()=>{x.timer_stop&&L(W,0)});var p=Ne(),m=l(p),b=l(m,!0);s(m);var R=v(m,2),O=l(R,!0);s(R),s(p),w((S,C)=>{D(m,1,`${g.timer_start?"text-palewhite":"text-palewhite/40"} font-chivomono text-center text-5xl transition-colors duration-1000`),I(b,S),D(R,1,`${x.timer_start?"text-palewhite":"text-palewhite/40"} font-chivomono text-center text-5xl transition-colors duration-1000`),I(O,C)},[()=>g.timer_finish?te(Math.trunc(g.finishTime*100)):d(V),()=>x.timer_finish?te(Math.trunc(x.finishTime*100)):d(U)]),r(i,p),xe()}var Me=o("<span></span>"),Ve=o('<span class="bg-tempus-green/60 absolute right-40 rounded-lg px-2.5 py-1 text-2xl"> </span>'),ze=o('<span class="bg-tempus-green/60 absolute left-40 rounded-lg px-2.5 py-1 text-2xl"> </span>'),De=o('<div class="relative flex items-center justify-center"><!> <span class="flex"> </span> <!></div>'),Ie=o('<div class="mt-2 flex w-full justify-center"><div class="font-chivomono flex h-86 flex-col flex-wrap items-center gap-x-60 gap-y-3 text-3xl"></div></div>');function Re(i,n){ge(n,!0);let u=A(W);{for(const[f,p]of Object.entries(e))e[f]=JSON.parse(localStorage.getItem(f));window.addEventListener("storage",f=>{e[f.key]=JSON.parse(f.newValue)})}function W(){const f=new le([]);for(const[p,m]of Q.entries())f.set(p,m);for(const[p,m]of E.entries())f.has(p)?f.get(p)>E.entries()&&f.set(p,m):f.set(p,m);return f}var V=Ie(),U=l(V);oe(U,21,()=>d(u).entries(),ie,(f,p)=>{var m=A(()=>$e(d(p),2));let b=()=>d(m)[0],R=()=>d(m)[1];var O=De(),S=l(O);{var C=j=>{var H=Me();w(()=>D(H,1,`border-overlay-orange/70 absolute bottom-1.5 h-full w-90 rounded-lg border-t-3 hue-rotate-${e.hueRotate??""}`)),r(j,H)};T(S,j=>{b().includes("Course")&&j(C)})}var X=v(S,2),ne=l(X,!0);s(X);var ae=v(X,2);{var fe=j=>{var H=ke(),re=me(H);{var ve=a=>{var t=Ve(),c=l(t,!0);s(t),w(k=>I(c,k),[()=>(Q.get(b())-E.get(b())).toFixed(1)]),q(1,t,()=>Y),r(a,t)},ce=a=>{var t=ze(),c=l(t,!0);s(t),w(k=>I(c,k),[()=>(E.get(b())-Q.get(b())).toFixed(1)]),q(1,t,()=>Y),r(a,t)};T(re,a=>{Q.get(b())<E.get(b())?a(ve):a(ce,!1)})}r(j,H)};T(ae,j=>{Q.has(b())&&E.has(b())&&j(fe)})}s(O),w(j=>I(ne,j),[()=>te(R()*100)]),q(1,O,()=>we),r(f,O)}),s(U),s(V),r(i,V),xe()}const Ge=i=>{var n=He();oe(n,20,()=>({length:2}),ie,(u,W)=>{var V=qe();r(u,V)}),s(n),q(3,n,()=>we),r(i,n)};var Je=o('<img class="relative z-50 flex h-24 w-fit rounded-lg" alt="flag"/>'),Fe=o("<span> </span>"),Be=o("<div></div>"),Le=o('<div class="border-palewhite/50 size-8 border-4"></div>'),Ee=o('<span class="relative bottom-0.5 text-3xl opacity-50"> </span>'),Ae=o('<div><div></div> <div id="spacer"></div> <!> <div class="flex flex-col gap-2 text-5xl"><!> <div><!> <!> <!></div></div></div>'),qe=o('<div class="flex basis-1/2 items-center justify-center border-white text-3xl first:border-r-[1px]">960x540px</div>'),He=o('<div class="bg-palewhite/50 flex h-[540px] w-full shrink-0"></div>'),Ke=o('<div class="absolute flex h-15 w-full"><span class="absolute w-full justify-center self-center text-center">vs</span> <!> <!></div>'),Qe=o('<span class="relative left-2 flex w-full skew-x-[30deg] items-center justify-center py-3"> </span>'),Ue=o('<div class="bg-fullblack/90 border-palewhite/50 relative right-8 min-w-64 skew-x-[-30deg] rounded-br-xl border-r-4 border-b-4 px-12"><!></div>'),Xe=o('<span class="relative right-2 flex w-full skew-x-[-30deg] justify-center py-3"> </span>'),Ye=o('<div class="bg-fullblack/90 border-palewhite/50 relative left-8 ml-auto min-w-64 skew-x-[30deg] rounded-bl-xl border-b-4 border-l-4 px-12"><!></div>'),Ze=o('<div class="text-palewhite/75 relative flex h-16 w-full justify-between text-3xl"><!> <!> <!></div>'),et=o('<div class="relative basis-1/2 items-center justify-center gap-4"><div></div> <span> </span></div>'),tt=o(`<span class="absolute z-999 h-screen w-full bg-black/60 p-64 text-4xl">WebSocket connecting... <span class="text-palewhite/60 text-3xl">(if this takes more than a few seconds after setting the token, it's likely failed.)</span></span>`),at=o('<span class="absolute z-999 h-screen w-full bg-black/60 p-64 text-4xl opacity-0 transition-opacity delay-1000 duration-1000 starting:opacity-100">WebSocket connected.</span>'),rt=o("<!> <!>",1),st=o('<div><div class="relative flex h-32 w-full shrink-0"><!> <!> <!></div> <!> <!> <!></div>');function dt(i,n){ge(n,!0);const u=(a,t=de)=>{var c=Ae(),k=l(c),z=v(k,4);{var G=h=>{var M=Je();w(()=>Te(M,"src",`https://countryflagsapi.netlify.app/flag/${e[t()+"Flag"]??""}.svg`)),r(h,M)};T(z,h=>{e[t()+"Flag"]&&h(G)})}var y=v(z,2),N=l(y);{var $=h=>{var M=ke(),B=me(M);ue(B,()=>e[t()+"Name"],Se=>{var se=Fe(),ye=l(se,!0);s(se),w(()=>I(ye,e[t()+"Name"].name)),q(1,se,()=>Y),r(Se,se)}),r(h,M)};T(N,h=>{e[t()+"Name"]&&h($)})}var _=v(N,2),J=l(_);oe(J,17,()=>({length:e[t()+"Score"]}),ie,(h,M)=>{var B=Be();w(()=>D(B,1,`starting:border-palewhite/50 starting:bg-overlay-orange/0 border-palewhite/50 bg-overlay-orange shadow-[0px_0px_9px_3px_theme(--color-overlay-orange)] size-8 border-4 transition-all duration-1000 starting:shadow-none ${e.useTeamColors?"":`hue-rotate-${e.hueRotate}`}`)),r(h,B)});var F=v(J,2);oe(F,17,()=>({length:e.maxScore-e[t()+"Score"]}),ie,(h,M)=>{var B=Le();r(h,B)});var P=v(F,2);{var ee=h=>{var M=Ee(),B=l(M);s(M),w(()=>I(B,`PR ${e[t()+"PR"]??""}`)),r(h,M)};T(P,h=>{e.usePR&&h(ee)})}s(_),s(y),s(c),w(()=>{D(c,1,`relative flex basis-1/2 items-center gap-4 ${t()==="left"?"flex-row text-left":"flex-row-reverse text-right"}`),D(k,1,`absolute -z-10 h-full w-full ${t()==="left"?`bg-linear-to-r/oklch ${e.useTeamColors?d(f):d(m)}`:`bg-linear-to-l/oklch ${e.useTeamColors?d(p):d(b)}`}`),D(_,1,`flex gap-2 ${t()==="left"?"flex-row":"flex-row-reverse"}`)}),r(a,c)},W=a=>{var t=Ze(),c=l(t);{var k=$=>{var _=Ke(),J=v(l(_),2);V(J,()=>"left");var F=v(J,2);V(F,()=>"right"),s(_),r($,_)};T(c,$=>{e.useTeams&&!e.useSinglePOV&&$(k)})}var z=v(c,2);{var G=$=>{var _=Ue(),J=l(_);ue(J,()=>e.stage,F=>{var P=Qe(),ee=l(P,!0);s(P),w(()=>I(ee,e.stage)),q(1,P,()=>Y),r(F,P)}),s(_),r($,_)};T(z,$=>{e.stage&&$(G)})}var y=v(z,2);{var N=$=>{var _=Ye(),J=l(_);ue(J,()=>e.map,F=>{var P=Xe(),ee=l(P,!0);s(P),w(()=>I(ee,e.map)),q(1,P,()=>Y),r(F,P)}),s(_),r($,_)};T(y,$=>{e.map&&$(N)})}s(t),r(a,t)},V=(a,t=de,c=de)=>{var k=et(),z=l(k),G=v(z,2),y=l(G,!0);s(G),s(k),w(N=>{D(z,1,`absolute -z-10 h-full w-full ${N??""}`),D(G,1,`text-palewhite absolute z-10 flex h-full w-full items-center justify-center text-4xl text-nowrap ${t()==="left"?"flex-row-reverse":"flex-row"}`),I(y,e[t()+"Team"])},[()=>t()==="left"?` bg-linear-to-r/oklch ${(e.useTeamColors?d(f):d(m)).replace("to-fullblack/60","to-fullblack/0")} to-90%`:` bg-linear-to-l/oklch ${(e.useTeamColors?d(p):d(b)).replace("to-fullblack/60","to-fullblack/0")} to-90%`]),r(a,k)};function U(a){if(a.track!==0)return;const t=`${a.steamid}`===e.leftName.steamid?"left":`${a.steamid}`===e.rightName.steamid?"right":null;if(t)switch(a.type){case"timer_start":Oe(t);break;case"timer_stop":je(t);break;case"timer_checkpoint":console.log("sending checkpoint to side "+t),Ce(t,a.formattedCheckpoint,a.time);break;case"timer_finish":We(t,a.time);break}}let f=A(()=>`from-tf-blu ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75%`),p=A(()=>`from-tf-red ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75%`),m=A(()=>`from-overlay-orange/90 ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),b=A(()=>`from-overlay-orange/90 ${e.useSinglePOV?" to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),R=pe(!1),O;{for(const[a,t]of Object.entries(e))e[a]=JSON.parse(localStorage.getItem(a));window.addEventListener("storage",a=>{e[a.key]=JSON.parse(a.newValue)}),K(()=>{if(e.useWebSocket&&e.useWebSocketToken!==""){const a=e.useWebSocketToken;O=new WebSocket(`wss://flyio-silent-sea-6505.fly.dev/?token=${a}`),O.onopen=t=>{console.log("[WebSocket] connection opened."),L(R,!0)},O.onmessage=t=>{const c=JSON.parse(t.data);console.log("[WebSocket] received data..",c),U(c)}}return()=>{O&&(O.close(),console.log("[WebSocket] closed previous connection."),L(R,!1))}}),e.useWebSocket&&e.useWebSocketToken!==""&&K(()=>{e.leftName,e.rightName,be("left"),be("right"),_e.state=!0})}var S=st(),C=l(S),X=l(C);{var ne=a=>{var t=rt(),c=me(t);Pe(c,{});var k=v(c,2);{var z=y=>{var N=tt();q(1,N,()=>Y),r(y,N)},G=y=>{var N=at();r(y,N)};T(k,y=>{d(R)?y(G,!1):y(z)})}r(a,t)};T(X,a=>{e.useWebSocket&&e.useWebSocketToken!==""&&e.leftName.steamid&&e.rightName.steamid&&a(ne)})}var ae=v(X,2);u(ae,()=>"left");var fe=v(ae,2);u(fe,()=>"right"),s(C);var j=v(C,2);{var H=a=>{Ge(a)};T(j,a=>{e.useSinglePOV||a(H)})}var re=v(j,2);W(re);var ve=v(re,2);{var ce=a=>{Re(a,{})};T(ve,a=>{e.useWebSocket&&e.useWebSocketToken!==""&&e.leftName.steamid&&e.rightName.steamid&&a(ce)})}s(S),w(a=>D(S,1,`font-${a??""} flex h-screen w-screen flex-col overflow-hidden`),[()=>e.font.toLowerCase()]),r(i,S),xe()}export{dt as component};
